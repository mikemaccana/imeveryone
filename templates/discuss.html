{% extends "base.html" %}

{% block css %}
{% end %}

{% block js %}
	<script type="text/javascript" src="{{ static_url("jcollapsible/jCollapsible.min.js") }}" ></script>
	<script type="text/javascript">
		
		$(document).ready(function(){			
			// Toggle creating and destroying an 'addcommentbox' child
			// Live allows us to manipulate DOM elements made even after the document is ready
			$('.addcomment').live('click', function(event) {
				if ($(this).siblings('.addcommentbox').length == 0) {
			      	action = $(this).attr("href");
					content = $('<div class="addcommentbox"><form action="'+action+'" method="post"><textarea class="commentinput" name="posttext"></textarea>{{ xsrf_form_html() }}<input type="hidden" value="{{ nexturl }}" name="nexturl"><input type="submit" value="Post comment" id="opener" class="button" /></form></div>').hide();
					content.appendTo($(this).parent()).slideDown();			        
					event.preventDefault();				
			    } else {
			      	$(this).siblings('.addcommentbox').slideUp("normal", function() {
					     $(this).remove();
					});
					event.preventDefault();	
			    };
			});
			
			// Create offset, collapsed comments	
		    $('#commenttree').collapsible({xoffset:'-7',yoffset:'5',defaulthide: false});
		});
		
	</script>


		
{% end %}

{% block mainarea %}


	<div id="contentwide">
		<!-- main-block -->		
		<div class="post">
			<div class="topmessage">
				{% include 'fullmessage.html' %}	
			</div>
			<div id="commentarea">
				<ul id="commenttree">	
					{% for item in commenttree %}
						{% if item == 'in' %}
							<ul>
						{% elif item == 'out' %}
							</ul>
							</li>
						{% else %}
							<li>
								<div class="comment">
									<div class="commentheading">
										{{ item['prettydate'] }}
									</div>
									<div class='message'>
										<img class='floatleft' src="/static/images/avatars/{{ item['avatar'] }}.png"/>
										<div class="commenttext">
											<p class="hyphenate">{{escape (item['posttext'])}}</p>
										</div>	
										<a href='/discuss/{{item['_id']}}' class="addcomment">Reply</a>
										<div class='rightalign'><em>{{ item['_id'] }}</em></div>
									</div>
								</div>	
							<!-- only close if there are no replies-->	
							{% if not len(item['comments']) %}
								</li>
							{% end %}
						{% end %}							
					{% end %}
				</ul>
			</div>

		</div>
		<!-- block -->
	</div>


	
{% end %}	

