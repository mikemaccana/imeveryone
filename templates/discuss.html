{% extends "basenosidebar.html" %}

{% block css %}
{% end %}

{% block js %}
	<script type="text/javascript" src="{{ static_url("jcollapsible/jCollapsible.min.js") }}" ></script>
	<script type="text/javascript">
		
		$(document).ready(function(){			
			// Toggle creating and destroying an 'addcommentbox' child
			// Live allows us to manipulate DOM elements made even after the document is ready
			$('.addcomment').live('click', function(event) {
				if ($(this).siblings('.addcommentbox').length == 0) {
			      	action = $(this).attr("href");
					content = '<div class="addcommentbox"><form action="'+action+'" method="post"><textarea class="commentinput" name="posttext"></textarea>{{ xsrf_form_html() }}<input type="hidden" value="{{ nexturl }}" name="nexturl"><input type="submit" value="Post comment" id="opener" class="button" /></form></div>';
					$(this).parent().append(content);	
					event.preventDefault();				
			    } else {
			      	$(this).siblings('.addcommentbox').remove();
					event.preventDefault();	
			    };
			});
			
				
		    $('#commenttree').collapsible({xoffset:'-10',yoffset:'5'});
		});
		
		
		
		
	</script>


		
{% end %}

{% block mainarea %}

<div class="post">
	<div class="topmessage">
		{% include 'showmessagedict.html' %}	
	</div>
	<div id="commentarea">
		<ul id="commenttree">	
			{% for item in commenttree %}
				{% if item == 'in' %}
					<ul>
				{% elif item == 'out' %}
					</ul>
					</li>
				{% else %}
					<li>
						<div class="comment">
							<div class="commentheading">
								{{ item['posttime'] }}
							</div>
							<div class='message'>
								<p>{{ item['posttext'] }}</p>
								<a href='/discuss/{{item['_id']}}' class="addcomment">Reply</a>
								<div class='rightalign'><em>{{ item['_id'] }}</em></div>
							</div>
						</div>	
					<!-- only close if there are no replies-->	
					{% if not len(item['comments']) %}
						</li>
					{% end %}
				{% end %}							
			{% end %}
		</ul>
	</div>
	
</div>
	
{% end %}	

