{% extends "base.html" %}

{% block css %}
{% end %}

{% block js %}
	<script type="text/javascript" src="{{ static_url("jcollapsible/jCollapsible.min.js") }}" ></script>
	<script type="text/javascript">
	
		content = '<div class="commentbox"><form action="/invite" id="inviterequest" method="post"><table><tr><td>Name</td><td><textarea class="input" name="name"></textarea></td></tr><tr><td>Message</td><td><textarea class="biginput" name="aboutme"></textarea></td></tr></table>{{ xsrf_form_html() }}<input type="submit" value="Add comment" id="opener" class="button" /></form></div>';
		
		$(document).ready(function(){			
			
			$('.replybutton').click(function(event, ui){
				setTimeout(function(){
					var target = jQuery('div.message'); 
					target.after(content)
				}, 250); 
				event.preventDefault();
			});


			
		    $('#commenttree').collapsible({xoffset:'-10',yoffset:'5'});
		});
		
		
		
		
	</script>


		
{% end %}

{% block mainarea %}

<div class="post">

	<em class="date"><a href="#"> {{message['posttime']}}</a></em>

	{% if 'posttext' in message %}
		<h2><a href="#">{{ escape(message['posttext'])}}</a></h2>
	{% else %}
		<h2><a href="#">No post text</a></h2>
	{% end %}	


	{% if message['intro'] is not None %}  
	    <div class="text-box">
			<a href="#">{{escape (message['intro'])}}</a>
		</div>	    
	{% end %}

	{% if 'embeds' in message %}
		{% for embed in message['embeds'] %}
			{% if 'html' in embed %}
				{{ embed['html'] }}<br/>
			{% end %}	
		{% end %}
	{% end %}
	{% if 'preview' in message %}
		{% if message['preview'] is not None %}
			<div class="visual">
				<a href="#" target="_blank"><img src="{{ message['preview'] }}" alt="image description" /></a>
			</div>
		{% end %}
	{% end %}
	
	<div class="read-more">
		<button id="getinvite" class="replybutton">
			{% if len(message['comments']) %}
				Add comment...
			{% else %}
				Be the first to comment
			{% end %}	
		</button>
		<em><a href="#">{{message['_id']}}</a></em>
	</div>

	<div id="commentarea">
		<ul id="commenttree">	
			{% for item in ['foo','bar','in','baz','woo','out','zam'] %}
				{% if item == 'in' %}
					<ul>
				{% elif item == 'out' %}
					</ul>
					</li>
				{% else %}
					<li>
						<div class="comment">
							<div class="commentheading">
								date and stuff
							</div>
							<div class='message'>
								<p>item
								<a href='/reply' class="replybutton">Reply</a>
								</p>
							</div>
						</div>	
					<!-- don't close if there's replies-->	
					{% if not item == 'bar' %}
						</li>
					{% end %}
				{% end %}							
			{% end %}
		</ul>
	</div>
	
</div>
	
{% end %}	

